import{r as e,w as t,o,a as n,c as l,b as i,d as a,v as s,u as r,e as c,f as d,D as u,g as p,h as g,M as h,i as f,t as b,p as y,j as m,k as w,l as S}from"./vendor.2feec13d.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const k=()=>{};k.toString=()=>`[DEBUG ${(new Date).toString()}]`;var v={log:console.log.bind(console,"%s",k)};const C=JSON.parse(localStorage.getItem("s3console")||"{}"),I=e(Object.assign({delimiter:"/",currentBucket:null,rememberedBuckets:[],prefix:"/",view_prefix:"/",applicationClientId:null,applicationLoginUrl:null,identityPoolId:null,showSettings:!0},C,{initialized:!1,showBucketSelector:!1,showBucketInfo:!1}));t(I,(()=>{localStorage.setItem("s3console",JSON.stringify(I))}));var A=new class{decode(e){try{return e&&JSON.parse(function(e){const t=(e=e.replace(/-/g,"+").replace(/_/g,"/")).length%4;if(t){if(1===t)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");e+=new Array(5-t).join("=")}return atob(e)}(e.split(".")[1]))}catch(t){return null}}};const P={class:"modal-dialog"},B={class:"modal-content"},O={name:"settings_form"},x=i("div",{class:"modal-header"},[i("h4",{class:"modal-title"},"S3 Explorer: Settings")],-1),E={class:"modal-body"},_={class:"col-md-18"},R=i("h2",null,"Welcome to the AWS S3 Explorer",-1),U={class:"",style:{width:"100%"}},L=i("div",null," Specify the Cognito User Pool login url and clientId ",-1),j=c(" Login Domain Url: "),T=i("br",null,null,-1),D=c(" Client ID: "),$=i("br",null,null,-1),N=c(" Identity Pool ID: "),z=i("br",null,null,-1),W=["disabled"],V=[i("i",{class:"fas fa-sign-in-alt"},null,-1),c(" Login")],J=d("<hr><div><h4>Setup Cognito SSO Login</h4> Or setup up a cognito pool, cognito identity pool, and configure the explorer. <ol><li> Cognito User Pool: <ul><li>Create a User Pool in any region (Not an identity pool)</li><li>Since we will use SSO, most of the configuration is irrelevant</li><li><strong>General settings &gt; Users and Groups &gt; Groups</strong> &gt; Update the auto generated group with a role that has access to the necessary buckets</li><li><strong>General settings &gt; App clients</strong> &gt; Add the S3 Console as an app</li><li><strong>Federation &gt; Identity providers</strong> &gt; Add your SSO provider of choice to the OAuth settings</li><li><strong>App Integration &gt; App client settings</strong> &gt; Enable identity provider just created</li><li>Specify <strong>https://rhosys.github.io/aws-s3-explorer/</strong> as the callback and logout urls</li><li>Specify <strong>Authorization code grant</strong> flow and enable All <strong>Allowed OAuth Scopes</strong></li><li><strong>App Integration &gt; Domain name</strong> &gt; Configure the setup for a domain (either Cognito or your own custom one.</li></ul></li><li> Cognito Identity Pool: <ul><li>Create an identity pool in the same region as the user pool</li><li>Specify the Cognito Pool from the previous step as the Authentication Provider</li><li><strong>Unauthenticated identities:</strong> &gt; Enable access to unauthenticated identities (You must enable this to work, unauthenticated users will not be allowed access, so it is not a security issue)</li></ul></li><li>Return here and enter the Cognito user pool login URL, ID, and identity pool ID above.</li></ol></div>",2),M={setup(t){e({region:null});const c=async e=>await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e)),d=async()=>{const e=await c(crypto.getRandomValues(new Uint32Array(4)).toString());return Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")},p=new URL(location).searchParams,g=async()=>{if(I.initialized=!0,I.tokens&&u.fromSeconds(A.decode(I.tokens.access_token).exp)>u.utc())return await h(),void(I.showSettings=!1);const e=p.get("code");if(null!==e){const t=new URL(window.location);t.searchParams.delete("nonce"),t.searchParams.delete("expires_in"),t.searchParams.delete("access_token"),t.searchParams.delete("id_token"),t.searchParams.delete("state"),t.searchParams.delete("code"),t.searchParams.delete("iss"),history.replaceState({},void 0,t.toString());const o=localStorage.getItem("codeVerifier");if(null===o)throw new Error("Unexpected code");const n=Object.entries({grant_type:"authorization_code",client_id:I.applicationClientId,code:e,code_verifier:o,redirect_uri:`${window.location.origin}${window.location.pathname}`}).map((([e,t])=>`${e}=${t}`)).join("&"),l=await fetch(`${I.applicationLoginUrl}/oauth2/token`,{method:"POST",headers:new Headers({"content-type":"application/x-www-form-urlencoded"}),body:n});if(!l.ok)throw new Error(await l.json());const i=await l.json();return I.tokens=i,await h(),void(I.showSettings=!1)}if(!I.applicationLoginUrl||!I.applicationClientId||!I.identityPoolId)return;try{new URL(I.applicationLoginUrl)}catch(a){return}const t=await d(),o=await d();localStorage.setItem("codeVerifier",o);const n=(l=await c(o),btoa(String.fromCharCode.apply(null,new Uint8Array(l))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""));var l;const i=`${window.location.origin}${window.location.pathname}`;window.location=`${I.applicationLoginUrl}/oauth2/authorize?response_type=code&client_id=${I.applicationClientId}&state=${t}&code_challenge_method=S256&code_challenge=${n}&redirect_uri=${i}`,await h()};o((()=>{I.initialized||g()}));const h=async()=>{if(I.identityPoolId)try{AWS.config.region=I.identityPoolId.split(":")[0],AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:I.identityPoolId}),v.log("Checking credentials");const e=await(new AWS.STS).getCallerIdentity().promise();v.log("AWS Credentials Set",e)}catch(e){v.log("Failed to set credentials, following requests will not work due to the error:",e)}};return(e,t)=>(n(),l("div",null,[i("div",P,[i("div",B,[i("form",O,[i("div",null,[x,i("div",E,[i("div",_,[R,i("div",U,[L,i("div",null,[j,a(i("input",{name:"Login Domain URL","onUpdate:modelValue":t[0]||(t[0]=e=>r(I).applicationLoginUrl=e),type:"text",class:"form-control",placeholder:"https://domain.auth.eu-west-1.amazoncognito.com",required:"true",style:{"margin-right":"1rem"}},null,512),[[s,r(I).applicationLoginUrl]]),T,D,a(i("input",{name:"Application Client ID","onUpdate:modelValue":t[1]||(t[1]=e=>r(I).applicationClientId=e),type:"text",class:"form-control",placeholder:"4altof0dlefqqicdifb8tv4mjp",required:"true",style:{"margin-right":"1rem"}},null,512),[[s,r(I).applicationClientId]]),$,N,a(i("input",{name:"Cognito Identity Pool","onUpdate:modelValue":t[2]||(t[2]=e=>r(I).identityPoolId=e),type:"text",class:"form-control",placeholder:"eu-west-1:3b921bfd-4443-4a62-ba15-24efbe3b2a05",required:"true",style:{"margin-right":"1rem"}},null,512),[[s,r(I).identityPoolId]]),z,i("button",{type:"submit",class:"btn btn-primary",disabled:!r(I).applicationLoginUrl||!r(I).applicationClientId||!r(I).identityPoolId,onClick:g},V,8,W)]),J])])])])])])])]))}};const q={class:"modal-dialog"},H={class:"modal-content"},G={name:"settings_form"},F=i("div",{class:"modal-header"},[i("h4",{class:"modal-title"},"Select an S3 Bucket")],-1),K={class:"modal-body"},Y={class:"col-md-18"},Q=i("h4",null,"Select a bucket or specify a new one:",-1),X=i("small",null,"Enter a bucket",-1),Z=c("Search for bucket"),ee={setup(e){const t=e=>{I.rememberedBuckets.push(e),I.currentBucket=e,I.showBucketSelector=!1},o=()=>{I.showBucketSelector=!1};return(e,a)=>(n(),l("div",null,[i("div",q,[i("div",H,[i("form",G,[i("div",null,[F,i("div",K,[i("div",Y,[Q,p(r(h),{modelValue:r(I).currentBucket,"onUpdate:modelValue":a[0]||(a[0]=e=>r(I).currentBucket=e),options:r(I).rememberedBuckets,placeholder:"",showLabels:!1,allowEmpty:!1,taggable:!0,"open-direction":"bottom","hide-selected":!0,closeOnSelect:!0,selectLabel:"(press enter to select)","tag-placeholder":"(press enter to select)",onTag:t,onSelect:o},{noOptions:g((()=>[X])),placeholder:g((()=>[Z])),_:1},8,["modelValue","options"])])])])])])])]))}},te={id:"InfoModal",tabindex:"-1"},oe={class:"modal-dialog"},ne={class:"modal-content"},le=i("h4",{class:"modal-title"},"S3 Explorer: Information",-1),ie={class:"modal-body"},ae={class:"col-md-18"},se={class:"nav nav-tabs","data-tabs":"tabs"},re=i("li",{role:"presentation",class:"active"},[i("a",{href:"#about","data-toggle":"tab"},"About")],-1),ce={role:"presentation"},de={key:0,href:"#cors","data-toggle":"tab"},ue={role:"presentation"},pe={key:0,href:"#policy","data-toggle":"tab"},ge=i("li",{role:"presentation"},[i("a",{href:"#corsref","data-toggle":"tab"},"CORS Reference")],-1),he=i("li",{role:"presentation"},[i("a",{href:"#policyref","data-toggle":"tab"},"Policy Reference")],-1),fe={id:"my-tab-content",class:"tab-content"},be=i("div",{class:"tab-pane active",id:"about"},[i("br"),i("p",null,"Amazon S3 Explorer is an application that uses the AWS JavaScript SDK in the Browser to make the contents of an S3 bucket easy to view in a web browser."),i("p",null,"To upload files, first navigate to the bucket & folder of your choice and then drag & drop files onto the main S3 Explorer table."),i("p",null,"To delete files, first choose the files you want to delete by clicking checkboxes in the Select column, then click the Trash icon. You will be asked to confirm this action."),i("p",null,[c("For more details and to download the source code, see our "),i("a",{target:"_blank",href:"https://github.com/rhosys/aws-s3-explorer"},"GitHub page"),c(".")])],-1),ye={key:0,class:"tab-pane",id:"cors"},me=i("br",null,null,-1),we=i("pre",null,[i("span",{id:"info-cors"})],-1),Se={key:1,class:"tab-pane",id:"policy"},ke=i("br",null,null,-1),ve=i("pre",null,[i("span",{id:"info-policy"})],-1),Ce=i("div",{class:"tab-pane",id:"corsref"},[i("br"),i("p",null," JavaScript in the browser cannot display the contents of an Amazon S3 bucket unless the bucket has the proper cross-origin resource sharing (CORS) configuration. "),i("p",null," To configure CORS, you create a CORS configuration that identifies the origins allowed to access your bucket and the operations (HTTP methods) supported. "),i("p",null," To do this, select your bucket in the buckets panel of the Amazon S3 Console and click to reveal Permissions in the Properties pane. Click Edit CORS Configuration. The CORS Configuration Editor panel will open up with a field where you can enter a CORS Configuration. Enter a configuration similar to the following: "),i("p",null,[i("pre",null,'  [\n    {\n        "AllowedHeaders": [\n            "*"\n        ],\n        "AllowedMethods": [\n            "PUT", "POST", "DELETE", "HEAD", "GET"\n        ],\n        "AllowedOrigins": [\n            "*"\n        ],\n        "ExposeHeaders": [\n            "x-amz-server-side-encryption",\n            "x-amz-request-id",\n            "x-amz-id-2"\n        ],\n        "MaxAgeSeconds": 3000\n    }\n]\n'),i("p",null,[c(" Please see the project "),i("a",{target:"_blank",href:"https://github.com/awslabs/aws-js-s3-explorer/blob/v2-alpha/README.md"},"README"),c(" for more specific details on how to create an appropriate CORS configuration. ")])])],-1),Ie={class:"tab-pane",id:"policyref"},Ae=i("br",null,null,-1),Pe=i("p",null,[c("Here is a sample S3 bucket policy that you can use. Change "),i("i",null,"999999999999"),c(" to your AWS account number and change "),i("i",null,"mybucket"),c(" to your bucket name.")],-1),Be=i("p",null,[c(" Please see the project "),i("a",{target:"_blank",href:"https://github.com/awslabs/aws-js-s3-explorer/blob/v2-alpha/README.md"},"README"),c(" for more specific details on how to create an appropriate S3 bucket policy. ")],-1),Oe={setup(t){const a=e({policy:null,cors:null});o((()=>{const e={Bucket:I.currentBucket};v.log("call getBucketPolicy:",I.currentBucket);const t=new AWS.S3({maxRetries:0});t.getBucketPolicy(e,((e,t)=>{e&&"NetworkingError"===e.code?a.cors="This bucket does not have CORS enabled, preventing gathering information about it.":e&&"NoSuchBucketPolicy"===e.code?(v.log(e),a.policy="No bucket policy."):e?(v.log(e.code,e),a.policy=JSON.stringify(e)):(v.log(t.Policy),a.policy=JSON.stringify(JSON.parse(t.Policy.trim()),null,2))})),t.getBucketCors(e,((e,t)=>{e&&"NetworkingError"===e.code?a.cors="This bucket does not have CORS enabled.":e&&"NoSuchCORSConfiguration"===e.code?(v.log(e),a.cors="This bucket has no CORS configuration."):e?(v.log(e.code,e),a.cors=JSON.stringify(e)):(v.log(t.CORSRules),a.cors=JSON.stringify(t.CORSRules,null,2))}))}));const s=()=>{I.showBucketInfo=!1};return(e,t)=>(n(),l("div",te,[i("div",oe,[i("div",ne,[i("div",{class:"modal-header"},[i("button",{type:"button",class:"close",onClick:s,"aria-hidden":"true"},"Ã—"),le]),i("div",ie,[i("div",ae,[i("ul",se,[re,i("li",ce,[r(I).currentBucket||!r(a).cors?(n(),l("a",de,"CORS")):f("",!0)]),i("li",ue,[r(I).currentBucket||!r(a).policy?(n(),l("a",pe,"Bucket Policy")):f("",!0)]),ge,he]),i("div",fe,[be,r(a).cors?(n(),l("div",ye,[me,i("p",null,"The currently configured CORS Configuration for "+b(r(I).currentBucket)+" is below.",1),we])):f("",!0),r(a).policy?(n(),l("div",Se,[ke,i("p",null,"The currently configured Bucket Policy for "+b(r(I).currentBucket)+" is below.",1),ve])):f("",!0),Ce,i("div",Ie,[Ae,Pe,i("p",null,[i("pre",null,'{\n  "Version": "2012-10-17",\n  "Statement": [{\n    "Sid": "PermissionsForUser",\n    "Effect": "Allow",\n    "Principal": {\n      "AWS": "arn:aws:iam::AWS_ACCOUNT_ID:roles/ROLE_ID"\n    },\n    "Action": "s3:*",\n    "Resource": "arn:aws:s3:::'+b(r(I).currentBucket)+'/*"\n  }]\n}\n',1),Be])])])])]),i("div",{class:"modal-footer"},[i("div",{class:"form-group"},[i("div",{class:"col-sm-offset-2 col-sm-10"},[i("button",{type:"button",class:"btn btn-default",onClick:s},"Close")])])])])])]))}};y("data-v-7588f7ba");const xe={class:""},Ee={class:"col-12"},_e={class:"panel panel-primary dropzone"},Re={class:"panel-heading",style:{display:"flex",direction:"row","align-items":"center","justify-content":"space-between"}},Ue={style:{display:"flex",direction:"row","align-items":"center"}},Le=i("div",{class:"title "},"AWS S3 Explorer",-1),je={key:0,class:"",style:{"margin-right":"0.5rem"}},Te={key:1},De={key:2},$e={key:0,class:"btn-group"},Ne={id:"badgecount",style:{cursor:"default"},class:"btn badge ",title:"Object count"},ze={key:1,class:"btn-group"},We={id:"badgecount",style:{cursor:"default"},class:"btn badge ",title:"Selected object count"},Ve={id:"navbuttons",class:""},Je={class:"btn-group"},Me=i("span",{style:{cursor:"pointer"},class:"btn fa fa-folder-plus fa-2x",title:"New folder"},null,-1),qe=["title","disabled"],He=i("div",{class:"panel-body"},[i("table",{class:"table table-bordered table-hover table-striped",style:{width:"100%"},id:"s3objects-table"},[i("thead",null,[i("tr",null,[i("th",{class:"text-center"},"Select"),i("th",null,"Object"),i("th",null,"Folder"),i("th",null,"Last Modified"),i("th",null,"Timestamp"),i("th",null,"Class"),i("th",null,"Size")])]),i("tbody",{id:"s3objects-tbody"})])],-1),Ge={class:"col-12"};m();const Fe={props:{msg:String},setup(t){const a=e({objectCount:0,keys_selected:[]});o((()=>{I.currentBucket=null,I.showBucketSelector=!1,I.showBucketInfo=!1,I.showSettings=!0}));const s=()=>{I.showBucketSelector=!0};return(e,t)=>(n(),l("div",xe,[i("div",Ee,[i("div",_e,[i("div",Re,[i("div",Ue,[Le,r(I).currentBucket?(n(),l("div",je,[i("button",{type:"button",class:"btn btn-default",onClick:s},b(r(I).currentBucket),1)])):(n(),l("div",Te,[i("button",{type:"button",class:"btn btn-default",onClick:s},"Select Bucket")])),r(I).currentBucket?(n(),l("div",De,[0===r(a).keys_selected.length?(n(),l("div",$e,[i("span",Ne,b(r(a).objectCount),1)])):f("",!0),r(a).keys_selected.length>0?(n(),l("div",ze,[i("span",We,b(r(a).keys_selected.length)+" of "+b(r(a).objectCount),1)])):f("",!0)])):f("",!0)]),i("div",Ve,[i("div",null,[i("div",Je,[Me,i("span",{style:{cursor:"pointer"},class:"btn fa fa-cloud-upload-alt fa-2x",onClick:t[0]||(t[0]=e=>{console.log("**** upload")}),title:"Upload files"}),i("span",{style:{cursor:"pointer"},class:"btn fa fa-trash-alt fa-2x",title:`Delete ${r(a).keys_selected.length} selected object(s)`,disabled:!r(a).keys_selected.length,onClick:t[1]||(t[1]=t=>e.trash())},null,8,qe),r(I).currentBucket?(n(),l("span",{key:0,style:{cursor:"pointer"},class:"btn fa fa-info-circle fa-2x",onClick:t[2]||(t[2]=e=>(I.showBucketInfo=!1,void(I.showBucketInfo=!0))),title:"Info"})):f("",!0),i("span",{style:{cursor:"pointer"},class:"btn fa fa-sync fa-2x",onClick:t[3]||(t[3]=e=>{console.log("*** Refresh")}),title:"Refresh"}),i("span",{style:{cursor:"pointer"},class:"btn fa fa-sign-out-alt fa-2x",onClick:t[4]||(t[4]=e=>(()=>{I.tokens=null;const e=`${window.location.origin}${window.location.pathname}`;window.location=`${I.applicationLoginUrl}/logout?client_id=${I.applicationClientId}&redirect_uri=${e}&response_type=code`})()),title:"Settings"})])])])]),He])]),i("div",Ge,[r(I).showSettings?(n(),w(M,{key:0})):f("",!0),r(I).showBucketSelector?(n(),w(ee,{key:1})):f("",!0),r(I).showBucketInfo?(n(),w(Oe,{key:2})):f("",!0)])]))},__scopeId:"data-v-7588f7ba"};S({setup:e=>(e,t)=>(n(),w(Fe))}).mount("#app"),AWS.config.update({region:""}),AWS.config.update({signatureVersion:"v4"});
